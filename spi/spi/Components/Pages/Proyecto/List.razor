@rendermode InteractiveServer
@page "/Proyecto"
@inject Services.Proyecto.ProyectoService ProyectoService
@using spi;
@using System.IO;
@using spi.Services.Proyecto;
@using spi.Models;
@using spi.Components.Pages.Proyecto;
@inject IJSRuntime JS
@inject NavigationManager Navigation

@using System.Data;

<div class="card shadow p-4"
     style="background-color:#f0f0f0;color:black;border-radius:12px;">

    <h2 class="text-center mb-3">Gestión de Proyectos</h2>
    <p class="text-center">Valida y administra los proyectos registrados</p>
    @Message

    <div class="text-start mb-3">
        <RadzenButton Text="Agregar Proyecto"
                      Icon="add_circle"
                      ButtonStyle="ButtonStyle.Primary"
                      Style="background-color:#00bcd4;border:none;font-weight:bold;
                                 border-radius:6px;box-shadow:0 4px 10px rgba(0,0,0,0.3);"
                      Click="@(() => createproy())" />
    </div>

    @if (orderDetails == null)
    {
        <p><em>Cargando...</em></p>
    }
    else
    {
        <div style="background-color:#2c2c2c;border-radius:8px;padding:1rem;">
            <RadzenDataGrid @ref="grid" Data="@orderDetails"
                            AllowVirtualization="true"
                            AllowFiltering="true"
                            FilterPopupRenderMode="PopupRenderMode.OnDemand"
                            FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                            LogicalFilterOperator="LogicalFilterOperator.Or"
                            AllowSorting="true"
                            TItem="Proyecto"
                            Style="height:400px;color:#e0e0e0;">
                <Columns>
                    <RadzenDataGridColumn Property="@nameof(Proyecto.des_proy)" Title="Proyecto" />
                    <RadzenDataGridColumn Property="@nameof(Proyecto.tipo_proy)" Title="Tipo" />
                    <RadzenDataGridColumn Title="Observaciones">
                        <Template Context="item">
                            <RadzenButton Icon="visibility"
                                          ButtonStyle="ButtonStyle.Secondary"
                                          Size="ButtonSize.Small"
                                          Style="background-color:#4dd0e1;color:#1e1e1e;
                                                                     border:none;border-radius:4px;
                                                                     transition:background 0.3s;"
                                          onmouseover="this.style.backgroundColor='#26c6da'"
                                          onmouseout="this.style.backgroundColor='#4dd0e1'"
                                          Click="@(() => IrADetalle(item.Id))" />
                        </Template>
                    </RadzenDataGridColumn>
                </Columns>
            </RadzenDataGrid>
        </div>
    }
</div>

@code {


    List<Proyecto> orderDetails;
    RadzenDataGrid<Proyecto> grid;



    public IEnumerable<Models.Proyecto> proyecto { get; set; }

    public string Message { get; set; }



    protected override async Task OnInitializedAsync()
    {

        try
        {

            orderDetails = await ProyectoService.GetAllProyectosAsync();

        }
        catch (Exception e)
        {
            Message = e.Message;
        }
    }


    private void createproy()
    {
        // Lógica de abrir modal o lo que necesites

        Navigation.NavigateTo("/createproy");


    }


    void IrADetalle(int id)
    {
        Navigation.NavigateTo($"/observaciones/{id}");
    }




}
